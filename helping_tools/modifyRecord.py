import pandas as pd
import ast
import csv

df = pd.read_csv('data/PTB_XL_data/ptbxl_database.csv')

inv_ides = [17, 18, 20, 23, 34, 144, 190, 351, 382, 385, 449, 498, 858, 1173, 1299, 1399, 1461, 1596, 1641, 1674, 1717, 1773, 1908, 1919, 2051, 2090, 2205, 2218, 2430, 2486, 2587, 2592, 2664, 2739, 2828, 2885, 3134, 3267, 3306, 3319, 3476, 3672, 3723, 3793, 3796, 3797, 3893, 3990, 4054, 4117, 4181, 4401, 4408, 4423, 4463, 4492, 4531, 4532, 4637, 4688, 4846, 4874, 4922, 4975, 5068, 5121, 5135, 5136, 5252, 5390, 5445, 5533, 5540, 5544, 5547, 5601, 5634, 5658, 5719, 5756, 5776, 5786, 5787, 6033, 6179, 6205, 6386, 6491, 6561, 6596, 6829, 7120, 7159, 7204, 7215, 7221, 7412, 7445, 7462, 7505, 7510, 7512, 7517, 7567, 7630, 7778, 7783, 7796, 7828, 7866, 7889, 8060, 8215, 8263, 8265, 8319, 8367, 8461, 8479, 8530, 8543, 8634, 8748, 8752, 8872, 8964, 8967, 8970, 8989, 9032, 9046, 9129, 9158, 9182, 9328, 9551, 9557, 9592, 9682, 9824, 9866, 10065, 10160, 10355, 10556, 10564, 10605, 10706, 10723, 10736, 10868, 10876, 10900, 10913, 10933, 10943, 10986, 11080, 11236, 11343, 11371, 11468, 11479, 11487, 11510, 11555, 11626, 11640, 11690, 11700, 11777, 11865, 11879, 11886, 11911, 11914, 11915, 11982, 12000, 12027, 12083, 12085, 12155, 12186, 12205, 12292, 12346, 12369, 12464, 12489, 12516, 12525, 12532, 12537, 12542, 12581, 12602, 12632, 12644, 12687, 12847, 12869, 12872, 12879, 12891, 12948, 12953, 12986, 13024, 13131, 13155, 13177, 13184, 13186, 13193, 13196, 13199, 13386, 13442, 13455, 13507, 13539, 13548, 13588, 13629, 13742, 13764, 13803, 13832, 13987, 14070, 14102, 14221, 14286, 14373, 14518, 14609, 14720, 14780, 14792, 14806, 14824, 14839, 14854, 14862, 14956, 14963, 14994, 15026, 15039, 15042, 15045, 15046, 15106, 15217, 15234, 15240, 15241, 15272, 15323, 15336, 15347, 15444, 15457, 15476, 15478, 15486, 15513, 15582, 15585, 15598, 15672, 15834, 15841, 15857, 15867, 16050, 16056, 16076, 16106, 16229, 16245, 16312, 16361, 16376, 16431, 16445, 16488, 16503, 16518, 16582, 16605, 16686, 16731, 16746, 16753, 16834, 16835, 16874, 16879, 16995, 17049, 17065, 17066, 17067, 17080, 17093, 17096, 17098, 17106, 17119, 17284, 17384, 17386, 17391, 17457, 17506, 17601, 18008, 18218, 18246, 18247, 18325, 18430, 18439, 18443, 18465, 18476, 18485, 18488, 18599, 18606, 18614, 18714, 18903, 18909, 18928, 18966, 19046, 19093, 19096, 19118, 19170, 19349, 19358, 19418, 19471, 19513, 19540, 19609, 19667, 19716, 19739, 19741, 19769, 19771, 19862, 19896, 19925, 19927, 19941, 19952, 19961, 20013, 20036, 20043, 20051, 20072, 20085, 20095, 20181, 20187, 20210, 20309, 20363, 20406, 20440, 20467, 20505, 20512, 20513, 20604, 20631, 20685, 20693, 20694, 20733, 20768, 20777, 20781, 20807, 20817, 20886, 20927, 20952, 21003, 21006, 21071, 21160, 21168, 21169, 21170, 21171, 21172, 21193, 21310, 21323, 21384, 21408, 21410, 21419, 21478, 21490, 21498, 21517, 21519, 21522, 21541, 21572, 21578, 21594, 21602, 21689, 21817]
df['scp_codes'] = df['scp_codes'].apply(ast.literal_eval)

def CreateTrainRecord():
    line = 0
    records = []
    for i in df['scp_codes']:
        if df["strat_fold"][line] != 9 and df["strat_fold"][line] != 10 :
            records.append(df["filename_hr"][line])
        line += 1
    with open('data/PTB_XL_data/RECORDS_TRAIN.txt', 'w', newline='') as file:
        for l in records:
            rec_id = l.split("/")[2].replace("_hr", "")
            rec_id_int = int(rec_id)  
            if rec_id_int not in inv_ides:
                file.write(l + "\n")
def CreateValidRecord():
    line = 0
    records = []
    for i in df['scp_codes']:
        if df["strat_fold"][line] == 9:
            records.append(df["filename_hr"][line])
        line += 1
    with open('data/PTB_XL_data/RECORDS_VALID.txt', 'w', newline='') as file:
        for l in records:
            rec_id = l.split("/")[2].replace("_hr", "")
            rec_id_int = int(rec_id) 
            if rec_id_int not in inv_ides:
                file.write(l + "\n")


def CreateTestRecord():
    line = 0
    records = []
    for i in df['scp_codes']:
        if df["strat_fold"][line] == 10:
            records.append(df["filename_hr"][line])
        line += 1
    with open('data/PTB_XL_data/RECORDS_TEST.txt', 'w', newline='') as file:
        for l in records:
            rec_id = l.split("/")[2].replace("_hr", "")
            rec_id_int = int(rec_id) 
            if rec_id_int not in inv_ides:
                file.write(l + "\n")

CreateTrainRecord()
CreateTestRecord()
CreateValidRecord()